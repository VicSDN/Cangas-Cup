---
import LayoutAdmin from '../../../layouts/LayoutAdmin.astro';
import ButtonBack from '../../../sections/ButtonBack.astro';
import TeamsList from '../../../components/admin/TeamsList.astro';

const url = new URL(Astro.request.url);
const currentYear = url.searchParams.get('year') || '2025';

const years = ['2025', '2026'];
---

<LayoutAdmin title="Equipos" description="Gestiona los equipos de la Cangas Cup">
  <ButtonBack />
  <main class="container mx-auto px-4 py-8">
    <TeamsList currentYear={currentYear} />
  </main>
</LayoutAdmin>

<script>
  const token = localStorage.getItem('sb-access-token');

  if (!token) {
    alert('No se encontró el token de autenticación. Por favor, inicie sesión nuevamente.');
    window.location.href = '/admin/signin';
    throw new Error('Token no disponible');
  }

  async function logout() {
    try {
      localStorage.removeItem('sb-access-token');

      const response = await fetch('/api/logout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
      });

      if (response.ok) {
        window.location.href = '/admin/signin';
      } else {
        throw new Error('Error al cerrar sesión');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error al cerrar sesión');
    }
  }

  const logoutButton = document.getElementById('logout-button');
  if (logoutButton) {
    logoutButton.addEventListener('click', logout);
  }
</script>
